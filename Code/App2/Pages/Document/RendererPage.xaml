<?xml version="1.0" encoding="utf-8" ?>
<uranium:UraniumContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                       xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
                       xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
                       xmlns:fa="clr-namespace:UraniumUI.Icons.FontAwesome;assembly=UraniumUI.Icons.FontAwesome"
                       xmlns:tk="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                       xmlns:pages="clr-namespace:Skinnix.Compoetry.Maui.Pages"
                       xmlns:local="clr-namespace:Skinnix.Compoetry.Maui.Pages.Document"
                       xmlns:components="clr-namespace:Skinnix.Compoetry.Maui.Components"
                       xmlns:v="clr-namespace:Skinnix.Compoetry.Maui.Views"
                       x:Class="Skinnix.Compoetry.Maui.Pages.Document.RendererPage"
                       x:DataType="local:RendererPageVM"
                       Title="{Binding Title}"
                       IsBusy="{Binding IsLoading}">

    <uranium:UraniumContentPage.ToolbarItems>
        <ToolbarItem Text="Tools" x:Name="toolsToolbarItem"
            Order="{OnIdiom Desktop=Primary, Default=Secondary}"
            Clicked="FlyoutButton_Clicked">
            <ToolbarItem.IconImageSource>
                <FontImageSource Glyph="&#xF085;" FontFamily="FontAwesomeSolid" Color="Gray" />
            </ToolbarItem.IconImageSource>
        </ToolbarItem>

        <ToolbarItem Text="Bearbeiten" x:Name="enterEditorToolbarItem"
            Order="{OnIdiom Desktop=Primary, Default=Secondary}"
            Command="{Binding EnterEditorCommand}">
            <ToolbarItem.IconImageSource>
                <FontImageSource Glyph="&#xF044;" FontFamily="FontAwesomeSolid" Color="Gray" />
            </ToolbarItem.IconImageSource>
        </ToolbarItem>
    </uranium:UraniumContentPage.ToolbarItems>

    <Grid tk:StateContainer.CurrentState="{Binding IsLoading}" RowDefinitions="*" ColumnDefinitions="*" Margin="0,0,0,22">
        <tk:StateContainer.StateViews>
            <HorizontalStackLayout tk:StateView.StateKey="True">
                <!--<ActivityIndicator IsRunning="True" HorizontalOptions="Center" />-->
                <Label HorizontalOptions="Center" Text="Lade Dokument..." />
            </HorizontalStackLayout>

            <Grid tk:StateView.StateKey="False" HorizontalOptions="Fill" VerticalOptions="Fill">
                <v:SingletonWrapperBlazorView Component="{Binding RootComponent}">
                    <x:Arguments>
                        <x:Boolean>False</x:Boolean>
                    </x:Arguments>
                </v:SingletonWrapperBlazorView>
            </Grid>
        </tk:StateContainer.StateViews>
    </Grid>

    <uranium:UraniumContentPage.Attachments>
        <v:SideSheetView x:Name="sideSheetView">
            <v:SideSheetView.Header>
                <ContentView BackgroundColor="Transparent" />
            </v:SideSheetView.Header>

            <ScrollView>
                <uranium:AutoFormView Source="{Binding RenderingSettings}" WidthRequest="500"
                                      ShowMissingProperties="False"
                                      ShowResetButton="False" ShowSubmitButton="False" />
            </ScrollView>
        </v:SideSheetView>

        <material:BottomSheetView CloseOnTapOutside="False" DisablePageWhenOpened="False">

            <FlexLayout Direction="Row" HorizontalOptions="Fill" Wrap="Wrap" Padding="5">

                <FlexLayout.Resources>
                    <ResourceDictionary>
                        <Style TargetType="Label">
                            <Setter Property="HeightRequest" Value="32" />
                            <Setter Property="WidthRequest" Value="32" />
                            <Setter Property="HorizontalOptions" Value="Fill" />
                            <Setter Property="HorizontalTextAlignment" Value="Center" />
                            <Setter Property="VerticalTextAlignment" Value="Center" />
                            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource SurfaceVariant}, Dark={StaticResource SurfaceVariantDark}}" />
                        </Style>

                        <Style TargetType="Button">
                            <Setter Property="HeightRequest" Value="32" />
                            <Setter Property="WidthRequest" Value="40" />
                            <Setter Property="Padding" Value="5" />
                            <Setter Property="CornerRadius" Value="0" />
                            <Setter Property="HorizontalOptions" Value="Fill" />
                        </Style>

                        <Style TargetType="Entry">
                            <Setter Property="HeightRequest" Value="32" />
                            <Setter Property="WidthRequest" Value="64" />
                            <Setter Property="HorizontalOptions" Value="Fill" />
                            <Setter Property="HorizontalTextAlignment" Value="Center" />
                        </Style>
                    </ResourceDictionary>
                </FlexLayout.Resources>

                <Border Stroke="Transparent"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 8"
                        Margin="5">
                    <Button Grid.Column="0" FontFamily="FontAwesomeSolid" Text="{x:Static fa:Solid.Maximize}"
                            Command="{Binding ToggleAutofitCommand}">
                        <Button.Triggers>
                            <DataTrigger TargetType="Button" Binding="{Binding RenderingSettings.Autofit}" Value="True">
                                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDarkText}}" />
                                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                                <Setter Property="BorderColor" Value="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>
                </Border>

                <Border Stroke="Transparent"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 8"
                                Margin="5">
                    <Grid ColumnDefinitions="auto,auto,auto,auto">
                        <Label Grid.Column="0" FontFamily="FontAwesomeSolid" Text="{x:Static fa:Solid.TextHeight}" />
                        <Button Grid.Column="1" FontFamily="FontAwesomeSolid" Text="-"
                                    Command="{Binding ChangeFontSizeCommand}" CommandParameter="{x:Int32 -1}" />
                        <Entry Grid.Column="2" ReturnType="Done" Text="{Binding RenderingSettings.FontSize}" Keyboard="Numeric" />
                        <Button Grid.Column="3" FontFamily="FontAwesomeSolid" Text="+"
                                    Command="{Binding ChangeFontSizeCommand}" CommandParameter="{x:Int32 1}" />
                    </Grid>
                </Border>

                <Border Stroke="Transparent"
                                StrokeThickness="0"
                                Margin="5"
                                StrokeShape="RoundRectangle 8">

                    <Grid ColumnDefinitions="auto,auto,auto,auto">
                        <Label Grid.Column="0" FontFamily="FontAwesomeSolid" Text="{x:Static fa:Solid.Music}" />
                        <Button Grid.Column="1" FontFamily="FontAwesomeSolid" Text="-"
                                    Command="{Binding ChangeTransposeCommand}" CommandParameter="{x:Int32 -1}" />
                        <Entry Grid.Column="2" ReturnType="Done" Text="{Binding RenderingSettings.Transpose}" Keyboard="Numeric" />
                        <Button Grid.Column="3" FontFamily="FontAwesomeSolid" Text="+"
                                    Command="{Binding ChangeTransposeCommand}" CommandParameter="{x:Int32 1}" />
                    </Grid>
                </Border>
            </FlexLayout>
        </material:BottomSheetView>
    </uranium:UraniumContentPage.Attachments>

</uranium:UraniumContentPage>
